<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá th·ªëng T·ªëi ∆∞u h√≥a Ph·ªëi tr·ªôn C√† ph√™</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header>
            <div class="logo">
                <span class="icon">‚òï</span>
                <h1>Coffee<span class="highlight">Blend</span>.AI</h1>
            </div>
            <div class="status-bar">
                <span id="market-status">D·ªØ li·ªáu th·ªã tr∆∞·ªùng: Tr·ª±c tuy·∫øn (VN Robusta ~120k)</span>
            </div>
        </header>

        <main>
            <!-- Left Panel: Configuration -->
            <section class="config-panel glass-panel">
                <h2>1. Kho Nguy√™n Li·ªáu (Batches)</h2>
                <div id="batch-list" class="batch-list">
                    <!-- Batches will be rendered here via JS -->
                </div>
                <button id="add-batch-modal-btn" class="secondary-btn">+ Th√™m l√¥ h√†ng th·ªß c√¥ng</button>

                <div class="separator"></div>

                <!-- Tab Navigation -->
                <div class="tabs">
                    <button class="tab-btn active" data-tab="tab-main">C·∫•u h√¨nh Ch√≠nh</button>
                    <button class="tab-btn" data-tab="tab-advanced">N√¢ng cao</button>
                </div>

                <!-- Tab Content: Main -->
                <div id="tab-main" class="tab-content active">
                    <h2>2. M·ª•c ti√™u & R√†ng bu·ªôc</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Thu·∫≠t to√°n (Engine)</label>
                            <select id="algorithm-select">
                                <option value="DEFAULT" selected>Google OR-Tools (Chu·∫©n)</option>
                                <option value="HYBRID">Hybrid Engine (Nhanh + Ch·∫∑t ch·∫Ω)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ch·∫ø ƒë·ªô T·ªëi ∆∞u</label>
                            <select id="opt-mode">
                                <option value="BALANCED" selected>C√¢n b·∫±ng (Gi√° & Ch·∫•t l∆∞·ª£ng)</option>
                                <option value="PRICE_OPTIMIZED">T·ªëi ∆∞u Gi√° (R·∫ª nh·∫•t)</option>
                                <option value="QUALITY_OPTIMIZED">T·ªëi ∆∞u Ch·∫•t l∆∞·ª£ng (V·ªã chu·∫©n nh·∫•t)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>T·ªïng s·∫£n l∆∞·ª£ng (kg)</label>
                            <input type="number" id="total-output" value="100">
                        </div>
                        <div class="form-group">
                            <label>Gi√° m·ª•c ti√™u (VND/kg)</label>
                            <input type="number" id="target-price" value="150000">
                        </div>
                        <div class="form-group">
                            <label>S·ªë lo·∫°i h·∫°t t·ªëi ƒëa</label>
                            <input type="number" id="max-types" value="3">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="chk-acid" checked> ƒê·ªô chua (Acid)
                            </label>
                            <input type="number" id="target-acid" step="0.1" value="5.0">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="chk-bitter" checked> ƒê·ªô ƒë·∫Øng (Bitter)
                            </label>
                            <input type="number" id="target-bitter" step="0.1" value="7.0">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="chk-sweet" checked> ƒê·ªô ng·ªçt (Sweet)
                            </label>
                            <input type="number" id="target-sweet" step="0.1" value="4.0">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="chk-caf" checked> Caffeine (%)
                            </label>
                            <input type="number" id="target-caf" step="0.1" value="2.0">
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Advanced -->
                <div id="tab-advanced" class="tab-content">
                    <h2>3. Tham s·ªë N√¢ng cao</h2>

                    <h3>Dung sai & Ph·∫°t (Penalty)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Dung sai Gi√° (+/- VND)</label>
                            <input type="number" id="tol-price" value="10000">
                        </div>
                        <div class="form-group">
                            <label>Dung sai V·ªã (+/- ƒêi·ªÉm)</label>
                            <input type="number" id="tol-flavor" step="0.1" value="0.5">
                        </div>
                        <div class="form-group">
                            <label>Ph·∫°t l·ªách v·ªã (Penalty)</label>
                            <input type="number" id="pen-flavor" value="20000">
                        </div>
                        <div class="form-group">
                            <label>Ph·∫°t H·∫øt H·∫°n (per Day)</label>
                            <input type="number" id="pen-expiry" value="100">
                        </div>
                    </div>

                    <div class="separator"></div>

                    <h3>Tr·ªçng s·ªë C·∫£m quan (Weights)</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Tr·ªçng s·ªë Chua (Acid)</label>
                            <input type="number" id="w-acid" step="0.1" value="1.0">
                        </div>
                        <div class="form-group">
                            <label>Tr·ªçng s·ªë ƒê·∫Øng (Bitter)</label>
                            <input type="number" id="w-bitter" step="0.1" value="2.0">
                        </div>
                        <div class="form-group">
                            <label>Tr·ªçng s·ªë Ng·ªçt (Sweet)</label>
                            <input type="number" id="w-sweet" step="0.1" value="1.0">
                        </div>
                        <div class="form-group">
                            <label>Tr·ªçng s·ªë Caffeine</label>
                            <input type="number" id="w-caf" step="0.1" value="0.5">
                        </div>
                    </div>

                    <div class="separator"></div>

                    <h3>C√†i ƒë·∫∑t Engine</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Th·ªùi gian ch·∫°y t·ªëi ƒëa (gi√¢y)</label>
                            <input type="number" id="solver-timeout" value="5">
                        </div>
                    </div>
                </div>

                <div class="separator"></div>
                <div class="btn-group">
                    <button id="optimize-btn" class="primary-btn">üöÄ Ch·∫°y T·ªëi ∆Øu H√≥a</button>
                    <button id="compare-btn" class="secondary-btn" style="margin-top: 10px;">‚öñÔ∏è So s√°nh 3 Ch·∫ø
                        ƒë·ªô</button>
                </div>
            </section>

            <!-- Right Panel: Results -->
            <section class="result-panel glass-panel">
                <div class="result-header">
                    <h2>K·∫øt qu·∫£ M√¥ ph·ªèng</h2>
                    <span id="result-status" class="badge">S·∫µn s√†ng</span>
                </div>

                <!-- Smart Retry Notification -->
                <div id="retry-alert" class="alert-box hidden">
                    <strong>‚ö†Ô∏è H·ªá th·ªëng ƒë√£ t·ª± ƒë·ªông n·ªõi l·ªèng r√†ng bu·ªôc:</strong>
                    <p id="retry-trace"></p>
                </div>

                <!-- Initial State / Empty State -->
                <div id="empty-state" class="empty-state">
                    <p>C·∫•u h√¨nh nguy√™n li·ªáu v√† nh·∫•n "Ch·∫°y T·ªëi ∆Øu H√≥a" ƒë·ªÉ xem k·∫øt qu·∫£.</p>
                </div>

                <!-- Results Content (Hidden initially) -->
                <div id="results-content" class="hidden">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <span class="label">Gi√° D·ª± ki·∫øn</span>
                            <span class="value" id="res-price">---</span>
                            <span class="sub" id="res-price-diff"></span>
                        </div>
                        <div class="metric-card">
                            <span class="label">ƒêi·ªÉm M·ª•c ti√™u</span>
                            <span class="value" id="res-score">---</span>
                        </div>
                        <div class="metric-card">
                            <span class="label">Th·ªùi gian</span>
                            <span class="value" id="res-time">---</span>
                        </div>
                    </div>

                    <div class="charts-container">
                        <div class="chart-wrapper">
                            <h3>T·ª∑ l·ªá Ph·ªëi tr·ªôn</h3>
                            <canvas id="compositionChart"></canvas>
                        </div>
                        <div class="chart-wrapper">
                            <h3>H·ªì s∆° C·∫£m quan (Radar)</h3>
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                    <h3>Chi ti·∫øt C√¥ng th·ª©c</h3>
                    <table class="recipe-table">
                        <thead>
                            <tr>
                                <th>T√™n L√¥</th>
                                <th>T·ª∑ l·ªá %</th>
                                <th>Kh·ªëi l∆∞·ª£ng (kg)</th>
                                <th>Th√†nh ti·ªÅn (VND)</th>
                            </tr>
                        </thead>
                        <tbody id="recipe-body">
                            <!-- Rows -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal for Adding/Editing Batch -->
    <div id="batch-modal" class="modal hidden">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h2 id="modal-title">Th√™m L√¥ h√†ng M·ªõi</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>T√™n L√¥ h√†ng / M√£</label>
                    <input type="text" id="modal-name" placeholder="VD: Robusta Dak Lak">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Gi√° (VND/kg)</label>
                        <input type="number" id="modal-price" value="120000">
                    </div>
                    <div class="form-group">
                        <label>T·ªìn kho (kg)</label>
                        <input type="number" id="modal-stock" value="1000">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>S·ªë ng√†y c√≤n l·∫°i (Expiry)</label>
                        <input type="number" id="modal-expiry" value="180">
                    </div>
                    <div class="form-group">
                        <label>Caffeine (%)</label>
                        <input type="number" id="modal-caf" step="0.1" value="2.0">
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>ƒê·ªô chua (Acid)</label>
                        <input type="number" id="modal-acid" step="0.1" value="5">
                    </div>
                    <div class="form-group">
                        <label>ƒê·ªô ƒë·∫Øng (Bitter)</label>
                        <input type="number" id="modal-bitter" step="0.1" value="5">
                    </div>
                    <div class="form-group">
                        <label>ƒê·ªô ng·ªçt (Sweet)</label>
                        <input type="number" id="modal-sweet" step="0.1" value="5">
                    </div>
                </div>
                <input type="hidden" id="modal-index"> <!-- To store editing index -->
            </div>
            <div class="modal-footer">
                <button id="save-batch-btn" class="primary-btn">L∆∞u th√¥ng tin</button>
            </div>
        </div>
    </div>

    <!-- Modal for Comparison Results -->
    <div id="compare-modal" class="modal hidden">
        <div class="modal-content glass-panel" style="width: 900px; max-width: 95%;">
            <div class="modal-header">
                <h2>So s√°nh Hi·ªáu su·∫•t 3 Ch·∫ø ƒë·ªô</h2>
                <button class="close-modal-compare">&times;</button>
            </div>
            <div class="modal-body" id="compare-body">
                <!-- Comparison Grid will be rendered here -->
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>

</html>